# v0.5.1 Design: Task-Class-First Plugins

## Theme
Shift plug-in development guidelines so that third-party packages primarily expose `Task` subclasses rather than decorated functions. This keeps room for future execution policies, hardware constraints, and validation hooks.

## Goals
1. **Standardize plug-ins on Task subclasses**  
   - Provide a canonical base class pattern (`class VisionTask(Task): ...`) that encapsulates inputs/outputs/policies.
   - Ensure `PluginRegistry` makes class registration ergonomic (e.g., `registry.add(VisionTask())`).

2. **Maintain compatibility for decorator-style functions**  
   - Existing plug-ins should keep working, but docs should mark decorators as “compatibility path”.
   - Add warnings or lint hints when functions lack required metadata.

3. **Prepare for constraints/metadata**  
   - By using classes we can attach attributes like `requires_gpu = True`, `max_retries`, `resource_tags`, etc.
   - Define validation hooks so pyoco core can enforce policies (e.g., verifying tasks declare `inputs`).

## Proposed Work

### 1. PluginRegistry Enhancements
- Add helper methods:
  - `registry.task_class(cls, *, name=None)` for explicit class registration.
  - Hooks to inspect class attributes (`policy`, `tags`, `constraints`).
- When a callable function is registered, auto-wrap into a lightweight Task subclass internally so the rest of the pipeline sees a uniform interface.

### 2. Documentation & Guides
- Update `docs/plugins.md`:
  - Present class-based example first, emphasizing how to embed metadata.
  - Provide migration notes for decorator users.
- Add lint checklist for plug-in authors (e.g., ensure `self.inputs` is defined, override `run()` method).

### 3. Validation / Tooling
- Optional `pyoco plugins lint` CLI to check third-party packages for required attributes.
- Extend tests (`tests/plugins/*`) to cover class registration, attribute validation, and fallback behavior.

## Timeline / Scope
- v0.5.1 focuses on guidelines and helper APIs; core engine behavior remains the same.
- Future versions can introduce actual scheduler/resource policies controlling these Task subclasses.
