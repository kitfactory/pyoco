# v0.5.1 Plan: Task-Class-First Plug-ins

v0.5.1 のゴールは、プラグインを `Task` サブクラス中心に整理し、今後の制約/メタデータ拡張に備えることです。以下のチェックリストに従って作業を進め、各項目ごとに対応する pytest を実行します。

## 1. PluginRegistry 強化
- [x] `registry.task_class()` などクラス登録用ヘルパーを追加し、`registry.add()` で `Task` サブクラスを扱いやすくする。
- [x] デコレータ経由で登録された関数を内部的に Task サブクラスへラップする実装を追加。
- **Test**: `PYTHONPATH=src .venv/bin/python -m pytest tests/plugins/test_entrypoint_loader.py tests/plugins/test_registry_task_class.py` ✅

## 2. バリデーションと警告
- [x] Task サブクラスに必須の属性（`inputs`, `outputs`, `run()` 等）を検証する仕組みを追加し、欠落時は警告を表示。
- [x] 既存の関数ベース登録でも互換動作は保ちつつ、警告メッセージを出す。
- **Test**: `PYTHONPATH=src .venv/bin/python -m pytest tests/plugins/test_validation.py` ✅

## 3. ドキュメント & ガイド更新
- [x] `docs/plugins.md` をクラス主体の内容へ書き換え、テンプレート/テスト手順を更新。
- [x] `docs/observability.md` などから該当箇所を参照する場合はリンクを調整。
- **Test**: ドキュメント生成のみ（lint/markdown チェックがある場合は実行）。

## 4. CLI & 開発者支援
- [x] `pyoco plugins list` にクラス/関数の区別や警告状態を表示する列を追加。
- [x] `pyoco plugins lint`（新規）でプラグインパッケージを検証できるようにする。
- **Test**: `PYTHONPATH=src .venv/bin/python -m pytest tests/cli/test_cli.py::test_cli_plugins_list tests/cli/test_cli_plugins_lint.py` ✅

## 5. 回帰テスト
- [x] プラグイン関連の追加テスト（plugins/cli）をまとめて実行。
- [x] 既存フルスイート回帰: `PYTHONPATH=src .venv/bin/python -m pytest`.

チェックがすべて付いたら v0.5.1 の実装完了とみなします。
