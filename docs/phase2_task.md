# フェーズ 2: 堅牢性とエラーハンドリング タスクリスト

> [!IMPORTANT]
> **テスト要件**: 各チェックリスト項目は、関連するテスト（既存または新規追加）がパスしたことを確認してから完了とし、次の項目に進んでください。

## 1. 失敗ポリシー (`core/engine.py`, `core/models.py`)
- [x] **タスクモデルの更新**
    - [x] `Task` モデルに `fail_policy: str` フィールドを追加する（デフォルト: "stop"）。
    - [x] サポート値: `stop`, `isolate`（独立したブランチは継続）, `retry`。
- [x] **Stop ポリシーの実装**
    - [x] `fail=stop` の場合、現在の動作（例外を発生させてフローを停止）が維持されることを確認する。
- [x] **Isolate ポリシーの実装**
    - [x] `fail=isolate` の場合、タスクの失敗を適切に処理するように実行ループを修正する。
    - [x] 失敗したタスクを「failed」としてマークする。
    - [x] 依存タスクの実行を阻止するが、独立したタスクは続行させる。
    - [x] いずれかのタスクが失敗した場合、最終的にフローを「failed」としてマークする。

## 2. リトライとタイムアウト (`core/engine.py`)
- [x] **タスクモデルの更新**
    - [x] `Task` モデルに `retries: int`（デフォルト: 0）と `timeout_sec: float`（デフォルト: None）を追加する。
- [x] **リトライロジックの実装**
    - [x] タスク実行をリトライループでラップする。
    - [x] 例外をキャッチし、リトライ回数を確認する。
    - [x] 指数バックオフを実装する（オプションだが推奨）。
- [x] **タイムアウトロジックの実装**
    - [x] タスク実行に `concurrent.futures.Future.result(timeout=...)` またはシグナルベースのタイムアウトを使用する。
    - [x] タスクが `timeout_sec` を超えた場合、`TimeoutError` を発生させる。
